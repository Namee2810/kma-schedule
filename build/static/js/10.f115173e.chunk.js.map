{"version":3,"sources":["global/functions/formatLesson.js","global/functions/createIcsString.js","components/DashBoardContent/DashBoardContentSchedule/index.jsx"],"names":["formatLessons","lessons","option","from","to","split","EVENTS","formatDate","date","year","getFullYear","toString","slice","month","getMonth","day","getDate","hours","getHours","minutes","getMinutes","seconds","getSeconds","createIcsString","schedule","uid","forEach","item","today","Date","lesson","begin","replace","end","summary","subjectName","location","room","description","className","teacher","event","CalendarMobile","React","lazy","getRandomColor","color","Math","floor","random","DashBoardContent_Schedule","props","useState","mobile","setMobile","useSelector","state","studentProfile","useEffect","updateSize","window","innerWidth","addEventListener","getSubjects","value","listSubjects","format","Number","push","moment","subjects","setSubjects","fullscreen","dateCellRender","length","count","map","placement","trigger","style","backgroundColor","title","subjectCode","content","validRange","firsDay","reverse","join","lastDay","String","onSelect","marginTop","onClick","url","downloadLink","document","createElement","href","download","studentCode","body","appendChild","click","removeChild","DownloadOutlined"],"mappings":"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","file":"static/js/10.f115173e.chunk.js","sourcesContent":["function formatLessons(lessons, option) {\r\n  lessons = lessons.split(\",\");\r\n  let from, to;\r\n  switch (lessons[0]) {\r\n    case \"1\": {\r\n      from = \"7h\";\r\n      break;\r\n    }\r\n    case \"4\": {\r\n      from = \"9h35\";\r\n      break;\r\n    }\r\n    case \"7\": {\r\n      from = \"12h30\";\r\n      break;\r\n    }\r\n    case \"10\": {\r\n      from = \"15h05\";\r\n      break;\r\n    }\r\n    case \"13\": {\r\n      from = \"18h\";\r\n      break;\r\n    }\r\n    default: break;\r\n  }\r\n  switch (lessons[2]) {\r\n    case \"3\": {\r\n      to = \"9h25\";\r\n      break;\r\n    }\r\n    case \"6\": {\r\n      to = \"12h\";\r\n      break;\r\n    }\r\n    case \"9\": {\r\n      to = \"14h55\";\r\n      break;\r\n    }\r\n    case \"12\": {\r\n      to = \"17h30\";\r\n      break;\r\n    }\r\n    case \"15\": {\r\n      to = \"21h20\";\r\n      break;\r\n    }\r\n\r\n    default: break;\r\n  }\r\n  if (option === 1) return (`${from}=>${to}`);\r\n  else return [from, to];\r\n};\r\n\r\nexport default formatLessons;","import formatLessons from \"./formatLesson\";\r\nconst BEGIN_CALENDAR = \"BEGIN:VCALENDAR\\r\\nVERSION:2.0\\r\\nPRODID:KMA Schedule (kma.namee.site)\\r\\nMETHOD:PUBLISH\\r\\nCALSCALE:GREGORIAN\\r\\n\";\r\nconst END_CALENDAR = \"END:VCALENDAR\"\r\n\r\nvar EVENTS = \"\";\r\n\r\nconst createIcsString = (schedule) => {\r\n  let uid = 0;\r\n  schedule.forEach(item => {\r\n    let today = formatDate(new Date());\r\n    let [from, to] = formatLessons(item.lesson), day = item.day.split(\"/\");\r\n    day = `${day[1]}/${day[0]}/${day[2]}`;\r\n    let begin = formatDate(new Date(`${day} ${from.replace(\"h\", \":\")}`)), end = formatDate(new Date(`${day} ${to.replace(\"h\", \":\")}`)),\r\n      summary = item.subjectName, location = item.room,\r\n      description = `Lớp: ${item.className}\\nTiết: ${item.room}\\nGiáo viên: ${item.teacher}`;\r\n    let event = `BEGIN:VEVENT\\r\\nUID:kma_schedule ${uid}\\r\\nDTSTAMP:${today}\\r\\nDTSTART:${begin}\\r\\nDTEND:${end}\\r\\nSUMMARY:${summary}\\r\\nLOCATION:${location}\\r\\nDESCRIPTION:${description}\\r\\nEND:VEVENT\\r\\n`\r\n    EVENTS += event;\r\n    uid++;\r\n  });\r\n  let ics = BEGIN_CALENDAR + EVENTS + END_CALENDAR;\r\n  return ics;\r\n}\r\n\r\nconst formatDate = (date) => {\r\n  let year = (\"0000\" + (date.getFullYear().toString())).slice(-4);\r\n  let month = (\"00\" + ((date.getMonth() + 1).toString())).slice(-2);\r\n  let day = (\"00\" + ((date.getDate()).toString())).slice(-2);\r\n  let hours = (\"00\" + (date.getHours().toString())).slice(-2);\r\n  let minutes = (\"00\" + (date.getMinutes().toString())).slice(-2);\r\n  let seconds = (\"00\" + (date.getSeconds().toString())).slice(-2);\r\n\r\n  let time = 'T' + hours + minutes + seconds;\r\n\r\n  date = year + month + day + time;\r\n  return date;\r\n}\r\n\r\nexport default createIcsString;","import { DownloadOutlined } from \"@ant-design/icons\";\r\nimport { Badge, Calendar, Popover, Tooltip } from 'antd';\r\nimport createIcsString from \"global/functions/createIcsString\";\r\nimport formatLessons from 'global/functions/formatLesson';\r\nimport moment from \"moment\";\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport \"./style.scss\";\r\n\r\nconst CalendarMobile = React.lazy(() => import(\"components/CalendarMobile\"));\r\n\r\nfunction getRandomColor() {\r\n  let color = Math.floor(Math.random() * 16777215);\r\n  return `#${color.toString(16)}`;\r\n}\r\n\r\nfunction DashBoardContent_Schedule(props) {\r\n  const [mobile, setMobile] = useState(false);\r\n  const schedule = useSelector(state => state.schedule);\r\n  const studentProfile = useSelector(state => state.studentProfile);\r\n\r\n  useEffect(() => {\r\n    const updateSize = () => {\r\n      if (window.innerWidth > 768) setMobile(false);\r\n      else setMobile(true);\r\n    }\r\n    window.addEventListener('resize', updateSize);\r\n    updateSize();\r\n\r\n  }, []);\r\n\r\n  const dateCellRender = (value) => {\r\n    const listSubjects = getSubjects(value);\r\n    if (listSubjects.length > 0)\r\n      return (\r\n        <div>\r\n          {\r\n            mobile\r\n              ? <Badge count={listSubjects.length} />\r\n              :\r\n              <ul className=\"DashBoardContent_Schedule__Calender__events\">\r\n                {listSubjects.map(item => (\r\n                  <Popover placement=\"right\" trigger=\"hover\" style={{ backgroundColor: getRandomColor() }}\r\n                    title={<b>{item.subjectName} ({item.subjectCode})</b>}\r\n                    content={\r\n                      <div>\r\n                        <p>Lớp: <b>{item.className}</b></p>\r\n                        <p>Thời gian: <b>{item.day} {formatLessons(item.lesson, 1)}</b></p>\r\n                        <p>Phòng: <b>{item.room}</b></p>\r\n                        <p>Giáo viên: <b>{item.teacher}</b></p>\r\n                      </div>\r\n                    }\r\n                    key={item.subjectCode + item.day}\r\n                  >\r\n                    <li style={{ backgroundColor: getRandomColor() }}>{item.subjectName}</li>\r\n                  </Popover>\r\n                ))}\r\n              </ul>\r\n          }\r\n        </div >\r\n      );\r\n  }\r\n\r\n  const getSubjects = (value) => {\r\n    let listSubjects = [];\r\n    value = value.format(\"DD-MM-YYYY\").split(\"-\");\r\n\r\n    schedule.forEach(item => {\r\n      let day = item.day.split(\"/\");\r\n      if (Number(value[0]) === Number(day[0])\r\n        && Number(value[1]) === Number(day[1])\r\n        && Number(value[2]) === Number(day[2])) listSubjects.push(item);\r\n    });\r\n\r\n    return listSubjects;\r\n  }\r\n\r\n  const [subjects, setSubjects] = useState(getSubjects(moment()));\r\n\r\n  const validRange = () => {\r\n    let firsDay = schedule[0].day.split(\"/\").reverse().join(\"\");\r\n    let lastDay = String(Number(schedule[schedule.length - 1].day.split(\"/\").reverse().join(\"\")) + 1);\r\n    return [moment(firsDay), moment(lastDay)];\r\n  }\r\n\r\n  const onSelect = (value) => {\r\n    const listSubjects = getSubjects(value);\r\n    setSubjects(listSubjects);\r\n  }\r\n\r\n  const downloadIcsFile = () => {\r\n    let ics = createIcsString(schedule);\r\n    let url = \"data:text/calendar;charset=utf-8,\" + ics;\r\n\r\n    var downloadLink = document.createElement(\"a\");\r\n    downloadLink.href = url;\r\n    downloadLink.download = `${studentProfile.studentCode}.ics`;\r\n\r\n    document.body.appendChild(downloadLink);\r\n    downloadLink.click();\r\n    document.body.removeChild(downloadLink);\r\n  }\r\n\r\n  return (\r\n    <div className=\"DashBoardContent_Schedule\">\r\n      <Calendar\r\n        fullscreen={!mobile}\r\n        dateCellRender={dateCellRender}\r\n        className=\"DashBoardContent_Schedule__Calender\"\r\n        validRange={validRange()}\r\n        onSelect={onSelect}\r\n      />\r\n      {mobile && <CalendarMobile subjects={subjects} />}\r\n      <Tooltip title=\"Tệp .ics có thể thêm vào các ứng dụng lịch trên Windows, Android, iOS và macOS (Microsoft Outlook, Google Calendar, Apple Calendar, ...)\" placement=\"bottom\">\r\n        <button className=\"DashBoardContent_Schedule__ics button\" style={{ backgroundColor: \"#2ACC37\", marginTop: \"30px\" }} onClick={downloadIcsFile}>\r\n          <DownloadOutlined /> Tải xuống .ics\r\n        </button>\r\n      </Tooltip>\r\n\r\n    </div >\r\n  );\r\n}\r\n\r\nexport default DashBoardContent_Schedule;"],"sourceRoot":""}